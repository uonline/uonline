mixin instanceLink(name, url, text, icon, forceNotActive)
	- var activity = (instance === name);
	- if (forceNotActive) activity = false;
	li.instance-link(class = (activity ? 'active' : null))
		if icon != null
			a.pjax(href=url)
				i.glyphicon(class=icon)
				| #{' '}#{text}
		else
			a.pjax(href=url) #{text}

if !pjax
	doctype html
	html
		head
			//- metadata
			meta(charset='utf-8')
			meta(http-equiv="X-UA-Compatible", content="IE=edge")
			meta(name='viewport', content='width=device-width, initial-scale=1.0')
			//- New Relic analytics
			!= (!!newrelic) ? newrelic.getBrowserTimingHeader() : ''
			//- and here we go
			title
				block title
			//- Bootstrap
			link(href='/static/bower_components/bootstrap/dist/css/bootstrap.min.css', rel='stylesheet')
			link(href='/static/bower_components/bootstrap/dist/css/bootstrap-theme.min.css', rel='stylesheet')
			:stylus
				.button-row
					line-height: 2.8em
			//- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
			//- WARNING: Respond.js doesn't work if you view the page via file://
			// if lt IE 9
				script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
				script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
		body
			div.navbar.navbar-default.navbar-static-top(role='navigation')
				div.container
					div.navbar-header
						button.navbar-toggle(type='button',data-toggle='collapse',data-target='.navbar-collapse')
							span.sr-only Toggle navigation
							span.icon-bar
							span.icon-bar
							span.icon-bar
						a.navbar-brand(href='/') uonline
					div.navbar-collapse.collapse
						ul.nav.navbar-nav
							+instanceLink('about','/about/','Об игре')
							//- Dropdown example
							//- li.dropdown
								a.dropdown-toggle(href='#', data-toggle='dropdown')
									| Dropdown
									b.caret
								ul.dropdown-menu
									li
										a(href='#') Action
									li
										a(href='#') Another action
									li
										a(href='#') Something else here
									li.divider
									li.dropdown-header Nav header
									li
										a(href='#') Separated link
									li
										a(href='#') One more separated link
						ul.nav.navbar-nav.navbar-right
							if loggedIn === true
								li
									a(href='/profile/')
										i.glyphicon(class=( admin ? 'glyphicon-certificate' : 'glyphicon-user' ))
										| #{' '}#{username}
								+instanceLink('profile', '/profile/', 'Профиль', null, !profileIsMine)
								+instanceLink('game', '/game/', 'Игра')
								li
									a(href='/action/logout') Выйти
							else
								+instanceLink('login', '/login/', 'Вход', 'glyphicon-chevron-right')
								+instanceLink('register', '/register/', 'Регистрация')
			div.container
				div.row
					div.col-md-12#content
						block content
				div.row
					div.col-md-12
						hr
						footer
							p.text-muted &copy; m1kc и К<sup>о</sup>, 2012&ndash;#{ now.getFullYear() }

			!= cachify_js('/assets/scripts.js')
			:coffee
				$(document).ready ->
					# Start up pjax
					$(document).pjax('a.pjax', '#content', timeout: 2000)
					$(document).on 'pjax:send', ->
						$('#content').animate opacity: 0.3, 'fast'
					$(document).on 'pjax:complete', ->
						$('#content').stop().css opacity: 1

					# Push buttons
					$('.instance-link').click ->
						$('.instance-link').removeClass 'active'
						$(this).addClass 'active'
else
	title
		block title
	block content
